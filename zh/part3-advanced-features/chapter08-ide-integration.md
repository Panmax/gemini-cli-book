# 第三章：高级特性与实战

欢迎来到本书的第三部分。在这一部分中，我们将超越基础，探索 Gemini CLI 提供的一些最强大的高级功能。这些功能将帮助您将 AI 更深、更无缝地集成到您的日常开发工作流中，应对更复杂的挑战。

---

# 第八章：集成开发环境 (IDE) 集成

虽然命令行是 Gemini CLI 的核心，但我们都知道，现代开发者的绝大部分时间是在集成开发环境 (IDE) 中度过的。为了打造真正无缝的 AI 辅助体验，Gemini CLI 提供了与 Visual Studio Code (VS Code) 的深度集成能力。

这种集成将 Gemini CLI 从一个独立的终端工具，转变为一个能够感知您 IDE 状态的、真正的编程伙伴。

## VS Code 集成的优势

启用 IDE 集成后，Gemini CLI 将获得以下超能力：

*   **强大的上下文感知:** Gemini CLI 能够直接“看到”您在 VS Code 中正在进行的工作。这包括：
    *   **当前打开的文件:** 它知道您正在编辑哪个文件，并能自动将其作为上下文，无需您手动使用 `@` 引用。
    *   **选中的代码:** 当您在编辑器中选中一段代码时，您的下一个问题将自动聚焦于这段代码，非常适合进行局部重构或代码解释。

*   **IDE 原生差分 (Diff) 视图:** 这是最强大的功能之一。当 Gemini CLI 建议对某个文件进行修改时，它不再仅仅是在终端中打印出代码。相反，它会在 VS Code 中打开一个**原生的、全屏的差分比较视图**。在这个视图中，您可以：
    *   清晰地看到红色（删除）和绿色（添加）的代码变更。
    *   在批准变更前，直接在差分视图中对 AI 建议的代码进行二次编辑和修正。
    *   通过点击确认按钮或使用快捷键 (`Cmd+S` / `Ctrl+S`)，一键接受变更，将修改应用到您的文件中。

这种“所见即所得”的交互方式，让代码变更的审查和批准过程既直观又安全，给予您完全的控制权。

## 安装与启用步骤

集成过程非常简单，通常只需要一两个命令。

**前提条件:**
*   请在 VS Code 的**集成终端** (Integrated Terminal) 中运行 Gemini CLI。
*   确保您的 Gemini CLI 版本不低于 `0.1.20`，VS Code 版本不低于 `1.99.0`。

### 步骤一：安装伴侣扩展

您需要安装一个名为 "Gemini CLI Companion" 的 VS Code 扩展。您有两种方式来安装它：

**1. 自动安装 (推荐):**
当您首次在 VS Code 的集成终端中运行 `gemini` 时，它通常会自动检测到环境，并给您一个提示：
```
[INFO] Gemini CLI can integrate with VS Code for a better experience.
[?] Install the companion VS Code extension to enable this? (Y/n)
```
只需输入 `Y` 并回车，Gemini CLI 就会自动为您安装和配置好伴侣扩展。

**2. 手动安装:**
如果由于某种原因您错过了自动提示，可以在 Gemini CLI 中运行以下命令来手动安装：
```
> /ide install
```
或者，您也可以直接在 VS Code 的扩展市场中搜索 "Gemini CLI Companion" 并点击安装。

### 步骤二：启用集成

安装完扩展后，集成默认是开启的。您可以通过以下命令来手动控制它的状态：

*   **/ide enable:** 启用 IDE 集成。
    ```
    > /ide enable
    ```
*   **/ide disable:** 暂时禁用 IDE 集成。
    ```
    > /ide disable
    ```

一旦启用，Gemini CLI 的提示符旁边会出现一个特殊的图标，表示它已成功连接到您的 VS Code 实例。

## 集成后的工作流示例

让我们看看启用集成后，您的工作流会变得多么流畅。

1.  **打开项目:** 在 VS Code 中打开您的项目，并打开一个您想修改的文件，例如 `app.js`。
2.  **打开集成终端:** 使用 `Ctrl+\`` 快捷键打开 VS Code 的集成终端。
3.  **启动 Gemini CLI:** 输入 `gemini` 启动交互式会话。
4.  **提出修改请求:** 此时，您无需使用 `@app.js`。Gemini CLI 已经知道您正在查看这个文件。您可以直接说：
    ```
    > 给 handleRequest 函数增加一个 try-catch 块来处理异常。
    ```
5.  **在 IDE 中审查 Diff:** Gemini CLI 会在 VS Code 中打开一个差分视图，清晰地展示它建议的 `try-catch` 代码块。
6.  **批准或修改:** 您可以在视图中检查代码。如果觉得不错，直接按 `Cmd+S` / `Ctrl+S` 保存文件，变更即被应用。如果需要微调，可以直接在右侧的编辑窗口中修改，然后再保存。
7.  **继续对话:** 回到终端，继续您的下一个任务。

通过这种方式，您可以在不离开 IDE 的情况下，完成“对话 -> 编码 -> 审查 -> 应用”的完整闭环，极大地提升了开发的沉浸感和效率。
