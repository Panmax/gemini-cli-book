# 第四部分：最佳实践与未来展望

恭喜您！您已经完成了本书所有核心功能的学习和实战演练。在最后一部分中，我们将后退一步，从更高的视角来探讨如何将 Gemini CLI 的能力发挥到极致，并展望 AI 在命令行工具中的未来。

---

# 第十一章：最佳实践与使用技巧

掌握了工具的功能只是第一步，真正决定您能走多远的是使用工具的方法和理念。本章将分享一系列经过验证的最佳实践和高级技巧，帮助您建立与 AI 高效协作的思维模型。

## 如何编写高效的提示 (Prompt Engineering)

提示（Prompt）是您与 AI 沟通的唯一桥梁，其质量直接决定了输出的质量。编写好的提示是一门艺术，更是一门科学，通常被称为“提示工程”。

以下是一些核心原则：

**1. 明确角色 (Assign a Role):**
在开始对话时，为 AI 设定一个角色。这能极大地帮助模型校准其回答的风格、重点和深度。

*   **不好的提示:** `解释一下 JavaScript 的闭包。`
*   **好的提示:** `你是一位资深的 JavaScript 教学专家，请用一个生动形象的比喻，为一位有一定编程基础但对闭包概念模糊的开发者解释一下什么是闭包。`

**2. 提供充足的上下文 (Provide Context):**
这是我们在前面章节反复强调的。不要让 AI 猜测，利用 `@` 符号、`GEMINI.md` 文件和清晰的背景描述，将所有相关信息都提供给它。上下文越丰富，答案越精准。

**3. 任务分解 (Break Down Tasks):**
对于复杂的任务，避免编写一个大而全的“超级提示”。而是应该将任务分解成多个逻辑步骤，通过连续的、循序渐进的对话来引导 AI 完成。这种“链式思考”的方式更符合人类解决问题的习惯，也更容易在中间步骤进行纠错和调整。

**4. 明确输出格式 (Specify Output Format):**
如果您希望得到特定格式的输出，请在提示中明确说明。

*   `请用 Markdown 表格的形式对比一下 React 和 Vue 的主要区别。`
*   `请为这个函数生成 JSDoc 风格的文档注释。`
*   `请返回一个 JSON 对象，其中包含 'name' 和 'version' 两个键。`

**5. 迭代与优化 (Iterate and Refine):**
不要期望一次就能得到完美的答案。优秀的成果往往来自于多次的迭代和微调。如果第一次的回答不理想，思考一下是提示中的哪个部分不够清晰，然后带着更精确的要求再次提问。

## 将与 Gemini CLI 的交互视为正式的软件工程流程

许多初学者会将 AI 助手当作一个随问随答的玩具，但这会限制它的潜力。我们建议您将与 Gemini CLI 的每一次交互，都视为一次微型的、正式的软件工程实践。

*   **需求分析:** 在编写提示前，清晰地思考您的“需求”是什么。
*   **设计:** 对于复杂任务，先通过对话与 AI 一起“设计”解决方案（如我们在第十章的案例三中所做）。
*   **编码:** 让 AI 生成代码。
*   **审查 (Code Review):** **这是最关键的一步。** 永远不要盲目信任 AI 生成的代码。利用 IDE 集成的差分视图，仔细审查每一行变更，确保它符合您的预期、没有引入新的 Bug，并且是安全可靠的。您是最终的负责人。
*   **测试:** 让 AI 辅助您生成单元测试或端到端测试，以验证代码的正确性。

## 在项目中持续使用 `gemini-cli` 的建议

*   **建立 `GEMINI.md` 规范:** 为您的每一个项目都创建一个 `GEMINI.md` 文件，定义该项目的技术栈、编码规范、核心架构等。这相当于为 AI 提供了一份永久的项目“入职培训”文档。
- **使用 `/chat save` 和 `/chat resume` 沉淀工作流:** 将您在解决典型问题（如“调试性能问题”、“发布新版本”）时的成功对话流程，通过 `/chat save <标签>` 保存下来，形成团队的“AI 最佳实践库”。
*   **结合 Git 使用:** 将 Gemini CLI 的操作与 Git 的版本控制紧密结合。在应用一次大的重构或添加一个新功能后，立即创建一个 Git 提交。这样，即使 AI 的操作出现问题，您也可以轻松地回滚到上一个稳定状态。

## 安全注意事项

AI 的强大能力也伴随着新的安全责任。请务必牢记以下几点：

*   **API 密钥的保管:** 您的 Google API 密钥是访问 Gemini 模型的凭证，与您的密码一样重要。
    *   **不要**将密钥硬编码在代码中。
    *   **不要**将包含密钥的 `settings.json` 文件提交到公共 Git 仓库。Gemini CLI 的默认配置已经将全局设置放到了 `.gitignore` 中，请确保您没有破坏这一点。
*   **警惕敏感信息:** 在与 AI 对话，特别是使用 `@` 引用文件时，请确保您没有将包含密码、私钥、客户数据等敏感信息的文件作为上下文提供给模型。
*   **审查 Shell 命令:** 对于 AI 建议执行的 shell 命令 (`!`)，一定要在确认前仔细审查，理解该命令的含义和潜在影响，尤其是在使用 `Ctrl+Y` (YOLO 模式) 时。

遵循这些最佳实践，您将能够更安全、更高效地利用 Gemini CLI，使其成为您开发工具箱中一把真正锋利的瑞士军刀。

## 常见问题与排查思路

即使遵循了最佳实践，您偶尔也可能遇到一些问题。以下是一些常见问题的解决方法。

### 认证与登录错误
- **错误: `Failed to login... Request contains an invalid argument` (登录失败...请求包含无效参数)**
  - **原因:** 这可能发生在 Google Workspace 或 Cloud 账户上。
  - **解决方法:** 对于 Cloud 账户，尝试设置 `GOOGLE_CLOUD_PROJECT` 环境变量为您的项目 ID。或者，从 [Google AI Studio](http://aistudio.google.com/app/apikey) 获取一个免费套餐的 Gemini API 密钥，并使用 `gemini config set` 进行配置。

- **错误: `UNABLE_TO_GET_ISSUER_CERT_LOCALLY` (无法获取本地颁发者证书)**
  - **原因:** 您很可能处于一个有防火墙拦截 SSL/TLS 流量的公司网络中。
  - **解决方法:** 设置 `NODE_EXTRA_CA_CERTS` 环境变量，使其指向您公司的根 CA 证书文件的绝对路径。

### 常见问题解答
- **如何更新到最新版本？**
  - 运行 `npm install -g @google/gemini-cli@latest`。

- **为什么我在 `/stats` 中看不到缓存的 token 数量？**
  - 此功能仅适用于通过 API 密钥（来自 Gemini API 或 Google Cloud Vertex AI）进行身份验证的用户，不适用于通过个人 Google 账户（OAuth）登录的用户。

### 常见错误信息
- **启动 MCP 服务器时出现 `EADDRINUSE` (地址已被占用)**
  - **原因:** 另一个进程正在使用您的 MCP 服务器需要的端口。
  - **解决方法:** 停止占用该端口的其他进程，或者将您的 MCP 服务器配置为使用其他端口。

- **安装后提示 `Command not found` (命令未找到)**
  - **原因:** 您的系统 `PATH` 环境变量不包含 `npm` 的全局二进制文件目录。
  - **解决方法:** 确保在您的 shell 启动文件（如 `.zshrc`, `.bash_profile`）中正确配置了 `npm` 的全局路径。

- **`"Operation not permitted"` (操作不允许) 或 `"Permission denied"` (权限被拒绝)**
  - **原因:** 沙盒功能正在阻止 AI 执行超出其允许范围的操作（例如，向项目目录之外的文件写入）。
  - **解决方法:** 这是预期的安全行为。如果该操作是必需的，您可能需要调整您的沙盒配置，但请注意相关的安全风险。
